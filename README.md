# fastAPI + neon
---

## **アプリケーションバックエンド要件定義書: ケイカくん API**

### 1. システム概要とアーキテクチャ

#### 1.1. 目的
本バックエンドは、福祉サービス事業所向けWebアプリケーション「ケイカくん」のサーバーサイド機能を提供する。主な責務は、データ永続化、ビジネスロジックの実行、フロントエンドへのAPI提供、外部サービスとの連携である。

#### 1.2. 技術スタック
*   **フレームワーク**: FastAPI
*   **言語**: Python 3.12+
*   **データベース**: Neon (PostgreSQL)
*   **ORM**: SQLAlchemy 2.0 (非同期モード)
*   **DBマイグレーション**: Alembic
*   **データ検証**: Pydantic V2
*   **コンテナ化**: Docker
*   **デプロイ先**: Google Cloud Run

#### 1.3. アーキテクチャ
厳格な**階層型アーキテクチャ（Layered Architecture）**を採用し、関心の分離を徹底する。

*   **API層 (`endpoints`)**: HTTPリクエストの受付とレスポンス返却に専念。認証・認可を処理し、リクエストを検証後、サービス層に処理を委譲する。
*   **サービス層 (`services`)**: ビジネスロジックの中核。複数のCRUD操作を組み合わせて単一のユースケースを実装し、トランザクションを管理する。
*   **CRUD層 (`crud`)**: データアクセス層。単一のDBモデルに対する基本的なCRUD操作のみを提供する。
*   **スキーマ層 (`schemas`)**: Pydanticを使用し、APIの入出力や層間でのデータ転送オブジェクト（DTO）を厳密に定義する。

### 2. 認証・認可要件

#### 2.1. 認証方式
*   自前実装による**JWT (JSON Web Token) ベースのトークン認証**を採用する。
*   パスワードは`passlib`と`bcrypt`アルゴリズムを用いてハッシュ化し、データベースに保存する。平文での保存は禁止する。

#### 2.2. ユーザーロール（権限）
システムは以下の3つのロールを管理し、APIエンドポイントごとにアクセス制御を行う。
*   `service_administrator`: 全機能へのアクセス権を持つ最高責任者。
*   `manager`: